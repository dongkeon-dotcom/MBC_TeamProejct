<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">


	
<mapper namespace="REVIEW">

    <insert id="REVIEWINSERT" parameterType="ReviewVO" useGeneratedKeys="true" keyProperty="reviewIdx">
    INSERT INTO Reviews (PRODUCT_IDX,   USER_IDX,  USER_NAME,  REVIEW,RATING, IS_HIDE,REG_DATE)
                 VALUES (#{productIdx}, #{userIdx},  #{userName},  #{review},  #{rating}, #{isHide}, NOW())
    </insert>

 
    <insert id="REVIEWINSERTIMG" parameterType="ReviewImageVO">
     INSERT INTO ReviewImage ( review_idx,  review_img) 
     				   VALUES (#{reviewIdx}, #{reviewImg} )
    </insert>
    
    <select id="REVIEWLIST" parameterType="long" resultType="com.mbcTeam.user.ReviewVO">

     SELECT DISTINCT
        r.review_Idx   AS reviewIdx,
        r.product_Idx  AS productIdx,
        r.user_Idx     AS userIdx,
        r.review       AS review,
        CONCAT(oi.color, '_', oi.size) AS userName 
    FROM Reviews r
    INNER JOIN OrderItems oi ON r.product_Idx = oi.product_Idx
    WHERE r.user_Idx = #{userIdx}
    </select>
</mapper>