<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="PRODUCT">

    <!-- 상품 등록 -->
    <insert id="INSERT_PRODUCT"
        parameterType="com.mbcTeam.product.ProductVO"
        useGeneratedKeys="true"
        keyProperty="productIdx">
        INSERT INTO Product (
            productCategory,
            productSubCategory,
            productName,
            productPrice,
            productRegDate,
            productDesc,
            pMainImgPath,
            pSizeImgPath,
            productDiscountPer,
            productRecomm
        )
        VALUES (
            #{productCategory},
            #{productSubCategory},
            #{productName},
            #{productPrice},
            NOW(),
            #{productDesc},
            #{pMainImgPath},
            #{pSizeImgPath},
            #{productDiscountPer},
            #{productRecomm}
        )
    </insert>

    <!-- 상품 이미지 등록 -->
    <insert id="INSERT_PRODUCT_IMG"
        parameterType="com.mbcTeam.product.ProductImgVO">
        INSERT INTO ProductImg (
            productIdx,
            pImgPath,
            pImgOrder
        )
        VALUES (
            #{productIdx},
            #{pImgPath},
            #{pImgOrder}
        )
    </insert>

    <!-- 상품 옵션 등록 -->
    <insert id="INSERT_PRODUCT_OPTION"
        parameterType="com.mbcTeam.product.ProductOptionVO">
        INSERT INTO ProductOption (
            productIdx,
            optionColor,
            optionSize,
            productStock
        )
        VALUES (
            #{productIdx},
            #{optionColor},
            #{optionSize},
            #{productStock}
        )
    </insert>

    <!-- 옵션 조회 -->
    <select id="SELECT_PRODUCT_OPTIONS"
        parameterType="int"
        resultType="com.mbcTeam.product.ProductOptionVO">
        SELECT optionColor, optionSize, productStock
        FROM ProductOption
        WHERE productIdx = #{productIdx}
    </select>

    <!-- 상품 목록 조회 -->
    <select id="SELECT_PRODUCT_LIST"
        resultType="com.mbcTeam.product.ProductVO">
        SELECT p.productIdx,
               p.productCategory,
               p.productSubCategory,
               p.productName,
               p.productPrice,
               p.productRegDate,
               p.productDesc,
               p.productDiscountPer,
               p.productRecomm,
               mainImg.pImgPath AS pMainImgPath,
               sizeImg.pImgPath AS pSizeImgPath
        FROM Product p
        LEFT JOIN ProductImg mainImg
               ON p.productIdx = mainImg.productIdx AND mainImg.pImgOrder = 1
        LEFT JOIN ProductImg sizeImg
               ON p.productIdx = sizeImg.productIdx AND sizeImg.pImgOrder = 2
        ORDER BY p.productRegDate DESC
    </select>

    <!-- 상품 상세 조회 (사용자용) -->
    <select id="SELECT_PRODUCT_DETAIL_USER"
        parameterType="int"
        resultType="com.mbcTeam.product.ProductVO">
        SELECT p.productIdx,
               p.productCategory,
               p.productSubCategory,
               p.productName,
               p.productPrice,
               p.productRegDate,
               p.productDesc,
               p.productDiscountPer,
               p.productRecomm,
               mainImg.pImgPath AS pMainImgPath,
               sizeImg.pImgPath AS pSizeImgPath
        FROM Product p
        LEFT JOIN ProductImg mainImg
               ON p.productIdx = mainImg.productIdx AND mainImg.pImgOrder = 1
        LEFT JOIN ProductImg sizeImg
               ON p.productIdx = sizeImg.productIdx AND sizeImg.pImgOrder = 2
        WHERE p.productIdx = #{productIdx}
    </select>

    <!-- 전체 상품 조회 -->
    <select id="SELECT_ALL_PRODUCTS"
        resultType="com.mbcTeam.product.ProductVO">
        SELECT p.productIdx,
               p.productCategory,
               p.productSubCategory,
               p.productName,
               p.productPrice,
               p.productRegDate,
               p.productDesc,
               p.productDiscountPer,
               p.productRecomm
        FROM Product p
        ORDER BY p.productRegDate DESC
    </select>

    <!-- 카테고리별 상품 조회 -->
    <select id="SELECT_BY_CATEGORY"
        parameterType="string"
        resultType="com.mbcTeam.product.ProductVO">
        SELECT p.productIdx,
               p.productCategory,
               p.productSubCategory,
               p.productName,
               p.productPrice,
               p.productRegDate,
               p.productDesc,
               p.productDiscountPer,
               p.productRecomm
        FROM Product p
        WHERE p.productCategory = #{category}
        ORDER BY p.productRegDate DESC
    </select>


	<!-- 리뷰 조회 -->
	<select id="SELECT_PRODUCT_REVIEWS" parameterType="int"
		resultType="com.mbcTeam.user.ReviewVO">
		SELECT r.reviewIdx,
		r.productIdx,
		r.userIdx,
		r.userName,
		r.reviewDesc,
		r.reviewRating,
		r.reviewHide,
		r.reviewRegDate
		FROM ProductReview r
		WHERE r.productIdx = #{productIdx}
		ORDER BY r.reviewRegDate DESC
	</select>



</mapper>
